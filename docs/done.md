# 実装済み機能

## Phase 1: MVP（基本動作）✅

Phase 1 の全機能が実装完了しました。

### 1.1 プロジェクト初期化 ✅

- Tauri 2.0 プロジェクト作成
- Cargo.toml 依存関係設定
- 基本ディレクトリ構造作成

**実装**: プロジェクトルート

### 1.2 グローバルショートカット ✅

- tauri-plugin-global-shortcut 設定
- Ctrl+Space で録音開始/停止

**実装**: `src-tauri/src/shortcuts/handler.rs`

### 1.3 音声キャプチャ ✅

- cpal でマイク入力取得
- 48kHz→16kHz リサンプリング（rubato）
- f32 PCM データとしてバッファリング
- Stereo → Mono 変換

**実装**:

- `src-tauri/src/audio/capture.rs`
- `src-tauri/src/audio/resample.rs`

**注意点**:

- Whisper は 16kHz mono f32 を要求
- 最大録音時間の制限なし（現在）

### 1.4 Whisper 推論 ✅

- whisper-rs 初期化（CUDA 版）
- ggml-large-v3-turbo.bin 読み込み
- 日本語指定で推論実行
- 結果をフロントエンドへ送信

**実装**: `src-tauri/src/whisper/transcribe.rs`

**CUDA 対応**:

- whisper-rs の `cuda` feature を有効化
- RTX 4070 Ti (12GB VRAM) で動作確認済み

**ビルド環境設定** (`.cargo/config.toml`):

- `CMAKE_GENERATOR=Ninja`: Visual Studio 18 (2026) は cmake クレートでまだサポートされていないため
- `CMAKE_CUDA_FLAGS="-allow-unsupported-compiler"`: CUDA 13.0 は VS 2019-2022 のみ公式サポートのため

### 1.5 クリップボード出力 ✅

- 認識結果をクリップボードにコピー（arboard）
- 自動ペースト（enigo で Ctrl+V シミュレート）

**実装**: `src-tauri/src/clipboard/mod.rs`

### 1.6 基本 UI ✅

- 録音インジケーター（波形 or アイコン）
- 認識結果表示

**実装**: `src/routes/+page.svelte`

**未実装**: システムトレイ常駐（Phase 3 で実装予定）

---

## 実装されたワークフロー

```
┌────────────────────────────────────────────────────────┐
│ ユーザーが Ctrl+Space を押下                            │
└──────────────────┬─────────────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────────────┐
│ AudioCapture: マイク入力開始 (cpal)                     │
│ - 任意サンプルレート (通常 48kHz)                       │
│ - Stereo → Mono 変換                                   │
└──────────────────┬─────────────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────────────┐
│ ユーザーが再度 Ctrl+Space を押下                        │
└──────────────────┬─────────────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────────────┐
│ AudioCapture: 録音停止、バッファ取得                    │
└──────────────────┬─────────────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────────────┐
│ Resampler: 16kHz にリサンプリング (rubato)              │
└──────────────────┬─────────────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────────────┐
│ Whisper: 音声認識実行 (CUDA)                            │
│ - Model: large-v3-turbo                                │
│ - Language: Japanese                                   │
└──────────────────┬─────────────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────────────┐
│ Clipboard: 結果をクリップボードにコピー                 │
│ - arboard: クリップボード操作                           │
│ - enigo: Ctrl+V で自動ペースト                         │
└────────────────────────────────────────────────────────┘
```

---

## 技術的成果

### CUDA アクセラレーション

- Whisper 推論を GPU で高速化
- RTX 4070 Ti で動作確認済み

### クロスプラットフォーム設計

- Tauri 2.0 により Windows/macOS/Linux 対応可能な基盤
- 現在は Windows をターゲットとして開発

### 低レイテンシー

- cpal による低遅延音声キャプチャ
- リアルタイムリサンプリング
- CUDA による高速推論
